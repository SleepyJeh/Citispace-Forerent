<div class="min-h-screen bg-[#F4F7FE] p-4 md:p-6 font-sans">

    {{-- 1. THE LAYOUT SHELL --}}
    <x-ui.card-with-tabs
        :tabs="[
            'payment' => 'Payment History',
            'maintenance' => 'Total Maintenance History'
        ]"
        :activeTab="$activeTab"
    >

        {{-- 2. THE FILTERS --}}
        <x-slot:filters>

            {{-- Month Filter --}}
            <x-dropdown label="{{ $monthOptions[$selectedMonth] ?? 'Month' }}">
                <x-dropdown-item wire:click="$set('selectedMonth', null)" @click="open = false">
                    All Months
                </x-dropdown-item>

                @foreach ($monthOptions as $value => $label)
                    <x-dropdown-item
                        wire:click="$set('selectedMonth', '{{ $value }}')"
                        @click="open = false"
                        :active="$selectedMonth === $value"
                    >
                        {{ $label }}
                    </x-dropdown-item>
                @endforeach
            </x-dropdown>

            {{-- Building Filter --}}
            <x-dropdown label="{{ $selectedBuilding ?? 'Building' }}">
                {{-- CLEAR FILTER OPTION --}}
                <x-dropdown-item wire:click="$set('selectedBuilding', null)" @click="open = false">
                    All Buildings
                </x-dropdown-item>

                @foreach ($buildingOptions as $value => $label)
                    <x-dropdown-item
                        wire:click="$set('selectedBuilding', '{{ $value }}')"
                        @click="open = false"
                        :active="$selectedBuilding === $value"
                    >
                        {{ $label }}
                    </x-dropdown-item>
                @endforeach
            </x-dropdown>

        </x-slot:filters>


        {{-- 3. THE CONTENT TABLES --}}

        {{-- Table A: Payment History --}}
        @if ($activeTab === 'payment')
            <x-ui.table>
                <x-slot:head>
                    <x-ui.th class="w-[25%]">Reference</x-ui.th>
                    <x-ui.th class="w-[25%]">Category</x-ui.th>
                    <x-ui.th class="w-[25%]">Date</x-ui.th>
                    <x-ui.th class="w-[25%]">Amount</x-ui.th>
                </x-slot:head>

                <x-slot:body>
                    @foreach ($paymentHistory as $payment)
                        <x-ui.tr>
                            <x-ui.td isHeader="true">{{ $payment->reference_number }}</x-ui.td>
                            <x-ui.td>{{ $payment->category }}</x-ui.td>
                            <x-ui.td>{{ \Carbon\Carbon::parse($payment->transaction_date)->format('F d, Y') }}</x-ui.td>
                            <x-ui.td>₱ {{ number_format($payment->amount, 2) }}</x-ui.td>
                        </x-ui.tr>
                    @endforeach
                </x-slot:body>
            </x-ui.table>
        @endif

        {{-- Table B: Maintenance History --}}
        @if ($activeTab === 'maintenance')
            <x-ui.table>
                <x-slot:head>
                    <x-ui.th class="w-[10%]">Unit</x-ui.th>
                    <x-ui.th class="w-[20%]">Tenant Name</x-ui.th>
                    <x-ui.th class="w-[15%]">Date</x-ui.th>
                    <x-ui.th class="w-[40%]">Problem</x-ui.th>
                    <x-ui.th class="w-[15%]">Cost</x-ui.th>
                </x-slot:head>

                <x-slot:body>
                    @foreach ($maintenanceHistory as $maintenance)
                        <x-ui.tr>
                            <x-ui.td isHeader="true">{{ $maintenance->unit_number }}</x-ui.td>
                            <x-ui.td>{{ $maintenance->tenant_name }}</x-ui.td>
                            <x-ui.td>{{ \Carbon\Carbon::parse($maintenance->completion_date)->format('F d, Y') }}</x-ui.td>
                            <x-ui.td class="truncate max-w-xs" title="{{ $maintenance->problem }}">
                                {{ $maintenance->problem }}
                            </x-ui.td>
                            <x-ui.td>₱ {{ number_format($maintenance->cost, 2) }}</x-ui.td>
                        </x-ui.tr>
                    @endforeach
                </x-slot:body>
            </x-ui.table>
        @endif

        {{-- 4. FOOTER PAGINATION --}}
        <x-slot:footer>
            @if($activeTab === 'payment')
                {{ $paymentHistory->onEachSide(1)->links('livewire.layouts.components.paginate-blue') }}
            @else
                {{ $maintenanceHistory->onEachSide(1)->links('livewire.layouts.components.paginate-blue') }}
            @endif
        </x-slot:footer>

    </x-ui.card-with-tabs>
</div>
